<!--
    @description       : Lighting web Component for edit opportunity product
    @author            : Kartik Patkar, Appstrail             
    @last modified on  : 30-11-2021
    @last modified by  : Kartik Patkar, Appstrail
    Modifications Log 
    Ver   Date         Author          Modification
    1.0   30-11-2021   Kartik Patkar   Initial Version
-->
<template>
    <article class="slds-card">
        <!--HEADER START-->
        <header class="slds-modal__header">
            <h2 class="slds-modal__title slds-hyphenate">
                Edit Product
            </h2>
        </header>
        <!--HEADER END-->

        <!--LOAD SPINNER-->
        <div if:true={load}>
            <lightning-spinner variant="brand" size="large"> </lightning-spinner>
        </div>

        <!--BODY START PAGE-->
        <div class="slds-card__body slds-card__body_inner modal-body-height slds-align_absolute-center"
            if:true={noProduct}>
            <c-illustration-component display-text="No Product Found"></c-illustration-component>
        </div>
        <div class="slds-card__body slds-card__body_inner modal-body-height slds-m-around--none slds-scrollable"
            if:false={noProduct}>
            <div class="slds-grid slds-wrap slds-p-left--small">
                <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-5 slds-scrollable">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_1-of-1 slds-p-top--xx-small">

                            <!--SELECTED PRODUCT TILE-->
                            <div class="slds-visual-picker slds-visual-picker_vertical product-option">
                                <input type="radio" id={oppProduct.OppPro.Id} checked />
                                <label for={oppProduct.OppPro.Name}>
                                    <span
                                        class="slds-visual-picker__figure slds-visual-picker__text slds-align_absolute-center product-option"
                                        style="padding:5px;">
                                        <div
                                            class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center slds-m-left_xx-small">
                                            <span style="width: 40px;height:40px;">
                                                <lightning-formatted-rich-text value={oppProduct.OppPro.ProductImage}>
                                                </lightning-formatted-rich-text>
                                            </span>
                                        </div>
                                        <div class="slds-media__body slds-border_left slds-p-left--small">
                                            <h2 class="slds-truncate slds-text-heading_small">{oppProduct.OppPro.Name}
                                            </h2>
                                            <p class="slds-m-top_small"></p>
                                        </div>
                                    </span>
                                    <span class="slds-icon_container slds-visual-picker__text-check">
                                        <svg class="slds-icon slds-icon-text-check slds-icon_x-small"
                                            aria-hidden="true">
                                            <use
                                                xlink:href="/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#check">
                                            </use>
                                        </svg>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!--MODES CHECKBOX LIST-->
                        <div class="slds-col slds-size_1-of-1">
                            <div class="coverage-box slds-m-top--xx-small">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-1 checkbox-section-title"
                                        if:true={oppProduct.OppPro.ModeLabel}>
                                        {oppProduct.OppPro.ModeLabel}
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <template if:true={showEditPaymentGateway}>
                                            <template for:each={paymentGatewayWrapperList.modeWrapperList}
                                                for:item="modes">
                                                <lightning-accordion key={modes.Id} allow-multiple-sections-open
                                                    active-section-name={activeSectionName} style="padding-bottom: 1px; padding-top: 1px;">
                                                    <lightning-accordion-section name={modes.modeName}
                                                        label={modes.modeName} class="accordian-alignment" >
                                                        <div class="slds-grid slds-grid_vertical">
                                                            <template for:each={modes.methodTypeWrapperList}
                                                                for:item="item">
                                                                <div class="slds-col" key={item.methodTypeId}>
                                                                    <div class="slds-checkbox">
                                                                        <input type="checkbox" name="options"
                                                                            id={item.methodTypeId}
                                                                            value={item.methodTypeId}
                                                                            data-method-id={item.methodTypeId}
                                                                            onchange={handlePaymentGatewayMethod} />
                                                                        <label class="slds-checkbox__label"
                                                                            for={item.methodTypeId}>
                                                                            <div class="slds-grid">
                                                                                <div class="slds-col">
                                                                                    <span
                                                                                        class="slds-checkbox_faux"></span>
                                                                                </div>
                                                                                <div class="slds-col">
                                                                                    <div class="slds-form-element__label slds-m-left--x-small slds-p-top--none"
                                                                                        style="display: block;">
                                                                                        <span>{item.methodName}</span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </lightning-accordion-section>
                                                </lightning-accordion>
                                            </template>

                                        </template>


                                        <template if:false={showEditPaymentGateway}>
                                            <template for:each={oppProduct.modeListMaster} for:item="modes">
                                                <div class="slds-form-element" key={modes.Id}>
                                                    <div class="slds-form-element__control">
                                                        <div class="slds-checkbox">
                                                            <input type="checkbox" checked={modes.check} name={modes.Id}
                                                                id={modes.Id} onclick={handleSelectMode}
                                                                disabled={modes.disable} />
                                                            <label class="slds-checkbox__label" for={modes.Id}>
                                                                <span class="slds-checkbox_faux"></span>
                                                                <span
                                                                    class="slds-form-element__label">{modes.Name}</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--SETTLEMENT CYCLE CHECKBOX LIST-->
                        <div class="slds-col slds-size_1-of-1">
                            <div class="coverage-box slds-box slds-m-top--xx-small">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-1 checkbox-section-title"
                                        if:true={oppProduct.OppPro.SettlementLabel}>
                                        {oppProduct.OppPro.SettlementLabel}
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <template for:each={oppProduct.settlementList} for:item="settlement">
                                            <div class="slds-form-element" key={settlement.Id}>
                                                <div class="slds-form-element__control">
                                                    <div class="slds-checkbox">
                                                        <input type="checkbox" name={settlement.Name}
                                                            value={settlement.Id} id={settlement.Id}
                                                            onclick={handleSettlement} checked={settlement.check}
                                                            data-id={settlement.Commercial__c} />
                                                        <label class="slds-checkbox__label" for={settlement.Id}>
                                                            <span class="slds-checkbox_faux"></span>
                                                            <span
                                                                class="slds-form-element__label">{settlement.Name}</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-5">
                    <!--ILLUSTRATION-->
                    <!-- <div if:true={selectModeIllustration}>
                        <c-illustration-component display-text="Select Modes"></c-illustration-component>
                    </div> -->

                    <div class="slds-m-around--xx-small slds-p-around_none" if:false={selectModeIllustration}>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-p-bottom--x-small">
                                <div class="slds-visual-picker_vertical product-option">
                                    <span
                                        class="slds-visual-picker__figure slds-visual-picker__text product-option slds-p-around--none">
                                        <div class="slds-grid slds-wrap">
                                            <div class="slds-col slds-size_1-of-1">

                                                <!--COVERAGE RECORD TABLE START-->
                                                <table class="slds-table slds-table_bordered slds-table_col-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th class="slds-text-title_caps td-height" scope="col"
                                                                rowspan="2">
                                                                <lightning-input type="checkbox" variant="label-hidden"
                                                                    onclick={handleSelectAll}>
                                                                </lightning-input>
                                                            </th>
                                                            <th class="slds-text-title_caps" scope="col" rowspan="2">
                                                                <div class="slds-truncate slds-align--absolute-center"
                                                                    title="Coverage">
                                                                    Coverage
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps" scope="col" colspan="2">
                                                                <div class="slds-truncate slds-align--absolute-center"
                                                                    title="List Price">
                                                                    List Price
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps" scope="col" colspan="2">
                                                                <div class="slds-truncate slds-align--absolute-center"
                                                                    title="Add-On">
                                                                    Add-On
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps" scope="col" colspan="2">
                                                                <div class="slds-truncate slds-align--absolute-center"
                                                                    title="Actual Price">
                                                                    Actual Sales Price
                                                                </div>
                                                            </th>
                                                        </tr>
                                                        <tr>
                                                            <th class="slds-text-title_caps remove-width left-border"
                                                                scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-percent"
                                                                    title="TDR(%)">
                                                                    TDR(%)
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps remove-width" scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-currency"
                                                                    title="Fixed Price(₹)">
                                                                    Fixed Price(₹)
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps remove-width left-border"
                                                                scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-percent"
                                                                    title="TDR(%)">
                                                                    TDR(%)
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps remove-width" scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-currency"
                                                                    title="Fixed Price(₹)">
                                                                    Fixed Price(₹)
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps remove-width" scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-percent"
                                                                    title="TDR(%)">
                                                                    TDR(%)
                                                                </div>
                                                            </th>
                                                            <th class="slds-text-title_caps remove-width" scope="col">
                                                                <div class="slds-truncate slds-align--absolute-center type-header field-currency"
                                                                    title="Fixed Price(₹)">
                                                                    Fixed Price(₹)
                                                                </div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!--ADDED LIST START-->
                                                        <template for:each={recordList} for:item="commercial">
                                                            <tr class="slds-hint-parent" key={commercial.Id}>
                                                                <th class="remove-width top-border-remove">
                                                                    <lightning-input type="checkbox"
                                                                        variant="label-hidden" name={commercial.Id}
                                                                        onclick={handleRecordSelect}
                                                                        checked={commercial.check}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <!-- <div class="slds-truncate">
                                                                                    <div class="slds-grid slds-wrap">
                                                                                        <div class="slds-col slds-size--3-of-5 slds-truncate" title={commercial.Name}>
                                                                                            {commercial.Name}
                                                                                        </div>
                                                                                        <div class="slds-col slds-size--2-of-5 slds-float__right"> 
                                                                                            <span class="slds-badge modes-badge">{commercial.ModeName}</span>
                                                                                        </div>
                                                                                    </div>
                                                                                    
                                                                                </div> -->
                                                                    <div style="width: 21rem;">
                                                                        <!-- <div class="slds-grid slds-wrap"> -->
                                                                        <div class="inline-section" style="width: 50%;"
                                                                            title={commercial.Name}>
                                                                            {commercial.Name}
                                                                        </div>
                                                                        <div class="slds-float_right inline-section">
                                                                            <span
                                                                                class="slds-badge modes-badge">{commercial.ModeName}</span>
                                                                        </div>
                                                                        <!-- </div> -->

                                                                    </div>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        value={commercial.CommPercent} readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" value={commercial.CommPrice}
                                                                        readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        data-id={commercial.Id}
                                                                        value={commercial.Add_On__c} name="addOn"
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" data-id={commercial.Id}
                                                                        value={commercial.Add_On_Price__c}
                                                                        name="addOnPrice" onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        name="actualPricePercent"
                                                                        value={commercial.Actual_Price_Percent__c}
                                                                        data-id={commercial.Id}
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" name="actualPrice"
                                                                        value={commercial.Actual_Price__c}
                                                                        data-id={commercial.Id}
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                            </tr>
                                                        </template>
                                                        <!--ADDED LIST END-->

                                                        <!--NEW LIST START-->
                                                        <template for:each={newList} for:item="commercial">
                                                            <tr class="slds-hint-parent" key={commercial.Id}>
                                                                <th class="remove-width top-border-remove">
                                                                    <lightning-input type="checkbox"
                                                                        variant="label-hidden" name={commercial.Id}
                                                                        onclick={handleNewRecordSelect}
                                                                        checked={commercial.check}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <!-- <div class="slds-truncate">
                                                                                <div class="slds-grid slds-wrap">
                                                                                    <div class="slds-col slds-size--3-of-5 slds-truncate" title={commercial.Name}>
                                                                                        {commercial.Name}
                                                                                    </div>
                                                                                    <div class="slds-col slds-size--2-of-5 slds-float__right"> 
                                                                                        <span class="slds-badge modes-badge">{commercial.ModeName}</span>
                                                                                    </div>
                                                                                </div>
                                                                                
                                                                            </div> -->
                                                                    <div style="width: 21rem;">
                                                                        <!-- <div class="slds-grid slds-wrap"> -->
                                                                        <div class="slds-truncate inline-section"
                                                                            style="width: 50%;" title={commercial.Name}>
                                                                            {commercial.Name}
                                                                        </div>
                                                                        <div class="slds-float_right inline-section">
                                                                            <span
                                                                                class="slds-badge modes-badge">{commercial.ModeName}</span>
                                                                        </div>
                                                                        <!-- </div> -->

                                                                    </div>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        value={commercial.CommPercent} readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" value={commercial.CommPrice}
                                                                        readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        data-id={commercial.Id}
                                                                        value={commercial.Add_On__c} name="addOn"
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" data-id={commercial.Id}
                                                                        value={commercial.Add_On_Price__c}
                                                                        name="addOnPrice" onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        name="actualPricePercent"
                                                                        value={commercial.Actual_Price_Percent__c}
                                                                        data-id={commercial.Id}
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" name="actualPrice"
                                                                        value={commercial.Actual_Price__c}
                                                                        data-id={commercial.Id}
                                                                        onchange={handleFieldChange}>
                                                                    </lightning-input>
                                                                </th>
                                                            </tr>
                                                        </template>
                                                        <!--ADDED LIST END-->


                                                        <!--SETTLEMENT LIST START-->
                                                        <template for:each={selectedSettlementList} for:item="settle">
                                                            <tr class="slds-hint-parent settlement-row" key={settle.Id}>
                                                                <th class="remove-width top-border-remove">
                                                                    <lightning-input type="checkbox"
                                                                        variant="label-hidden" checked={settle.check}
                                                                        disabled></lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <!-- <div class="slds-truncate">
                                                                                <div class="slds-grid slds-wrap">
                                                                                    <div class="slds-col slds-size--3-of-5 slds-truncate">
                                                                                        {settle.Name}
                                                                                    </div>
                                                                                    <div class="slds-col slds-size--2-of-5 slds-float__right"> 
                                                                                        <span class="slds-badge modes-badge">Settlement</span>
                                                                                    </div>
                                                                                </div> 
                                                                            </div> -->
                                                                    <div style="width: 21rem;">
                                                                        <!-- <div class="slds-grid slds-wrap"> -->
                                                                        <div class="slds-truncate inline-section"
                                                                            style="width: 50%;" title={settle.Name}>
                                                                            {settle.Name}
                                                                        </div>
                                                                        <div class="slds-float_right inline-section">
                                                                            <span
                                                                                class="slds-badge modes-badge">Settlement</span>
                                                                        </div>
                                                                        <!-- </div> -->

                                                                    </div>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" step="0.01"
                                                                        value={settle.Commercial__c} readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row">
                                                                    <lightning-input type="number"
                                                                        variant="label-hidden" formatter="currency"
                                                                        step="0.01" value={settle.Commercial_Price__c}
                                                                        readonly>
                                                                    </lightning-input>
                                                                </th>
                                                                <th scope="row" colspan="4">

                                                                </th>
                                                            </tr>
                                                        </template>
                                                        <!--SETTLEMENT LIST END-->

                                                    </tbody>
                                                </table>
                                                <!--COVERAGE RECORD TABLE END-->
                                            </div>
                                        </div>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--BODY END PAGE-->

        <!--FOOTER-->
        <footer class="slds-float_right extra-product-padding">
            <button class="slds-button slds-button_neutral" onclick={handleCancel}>
                Cancel
            </button>
            <button class="slds-button slds-button_brand" onclick={handleUpdate} disabled={disableSave}>
                Save
            </button>
        </footer>
    </article>
</template>