<!--
  @description       : 
  @author            : Saurav Kashyap
  @group             : Appstrail
  @last modified on  : 27-01-2023
  @last modified by  : Saurav Kashyap
  Modifications Log
  Ver   Date         Author           Modification
  1.0   25-01-2023   Saurav Kashyap   Initial Version
-->
<template>
  <template if:true={isModalOpen}>
    <!-- Modal/Popup Box LWC starts here -->
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
      aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
      <div class="slds-modal__container">
        <!-- Modal/Popup Box LWC header starts here -->
        <header class="slds-modal__header">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close"
            onclick={closeModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse"
              size="small"></lightning-icon>
            <span class="slds-assistive-text">Close</span>
          </button>
          <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
            {formHeaderTile}
          </h2>
        </header>
        <!-- Modal/Popup Box LWC header ends here -->

        <!-- Modal/Popup Box LWC body starts here -->
        <div class="slds-modal__content slds-p-around_medium slds-scrollable" id="modal-content-id-1"
          style="position: relative; height: 455px !important">
          <!-- Lightning Spinner ... Starts Here >>> -->
          <div if:true={load}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
          </div>
          <!-- Lightning Spinner ... Ends Here >>> -->

          <!-- Main Body Template Starts Here ... >>> -->
          <template if:true={isMainPageVisible}>
            <div class="bottom-top-padding-class">
              <div class="sidewise-padding">
                <div class="slds-grid slds-grid_vertical frame-class frame-color-class frame-border-radius"
                  style="height: 600px">
                  <div class={flexipageRegionWidth} style="padding: 15px; height: 300px">
                    <div class="slds-grid slds-wrap">
                      <!-- Segment-1 Starts Here-->
                      <!-- Row-1 and Col-1 -->
                      <!-- <div
                        class="slds-col slds-size--1-of-1 slds-m-top_medium slds-p-bottom_small slds-section-title slds-theme_shade"> -->
                      <!-- <p class="slds-m-left--medium slds-m-top--x-small">
                          Task Information
                        </p>
                      </div> -->

                      <!-- Task Type Information-->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <!-- <lightning-combobox name="taskType" label="Task Type" value={SALESFORCE_TASK_RECORD.taskType}
                            options={taskTypeList} onchange={handleFieldPartChange}>
                          </lightning-combobox>
                        </div> -->

                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Task Type</label>
                          <div class="slds-form-element__control">
                            <div class="slds-combobox_container">
                              <div data-id="tasktype"
                                class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click">
                                <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right">

                                  <button type="button" data-id="tasktypebuttonfocus"
                                    class="slds-input_faux slds-combobox__input" onclick={handleTaskTypeClick}>

                                    <div class="slds-media">
                                      <span class="slds-media__figure">
                                        <span class="slds-media__figure ">
                                          <template if:true={SALESFORCE_TASK_RECORD.taskType}>
                                            <span class="slds-icon_container slds-icon-standard-sossession">
                                              <svg class="slds-icon slds-icon_small">
                                                <use xlink:href={currentTaskIconName}>
                                                </use>
                                              </svg>
                                            </span>
                                          </template>
                                        </span>
                                      </span>
                                      <span class="slds-media__body">
                                        {SALESFORCE_TASK_RECORD.taskType}
                                      </span>

                                    </div>
                                    <!-- <span
                                    class="slds-icon-standard-account slds-current-color">
                                    <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default"
                                      aria-hidden="true">
                                      <use
                                        xlink:href={currentIconName}>
                                      </use>
                                    </svg>
                                  </span>

                                    <span>{SALESFORCE_TASK_RECORD.taskType}</span> -->

                                  </button>
                                  <!-- <input type="text" class="slds-input slds-combobox__input slds-has-focus" /> -->
                                  <span
                                    class="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right">
                                    <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default"
                                      aria-hidden="true">
                                      <use
                                        xlink:href="/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#down">
                                      </use>
                                    </svg>
                                  </span>
                                </div>

                                <div class="slds-dropdown slds-dropdown_length-with-icon-3 slds-dropdown_fluid">
                                  <ul class="slds-listbox slds-listbox_vertical">
                                    <template for:each={taskTypeList} for:item="taskItem">
                                      <li key={taskItem.label} class="slds-listbox__item" data-value={taskItem.value}
                                        onblur={handleRemoveTaskTypeClick} onclick={handleFieldPartChange}>
                                        <div
                                          class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta">
                                          <span class="slds-media__figure slds-listbox__option-icon">
                                            <span class="slds-icon_container slds-icon-standard-sossession">
                                              <svg class="slds-icon slds-icon_small">
                                                <use xlink:href={taskItem.icon_name}>
                                                </use>
                                              </svg>
                                            </span>
                                          </span>
                                          <!-- <a data-value={taskItem.value} onclick={handleFieldPartChange}> -->
                                          <span class="slds-media__body">
                                            <span
                                              class="slds-listbox__option-text slds-listbox__option-text_entity">{taskItem.value}</span>
                                          </span>
                                          <!-- </a> -->

                                        </div>
                                      </li>
                                    </template>
                                  </ul>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Task Type Information-->

                      <!-- <div class="slds-col slds-size--1-of-12" style="padding: 0px 0px 10px 0px"></div> -->
                      <!-- Row-5 and Col-2 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-combobox disabled="true" name="taskSubType" data-id="tasksubtypepicklist"
                          label="Task Sub Type" options={dependentPicklist} onchange={handleFieldSubParentChange}
                          value={deplendentPicklistValue}>
                        </lightning-combobox>
                      </div>

                      <!-- Row-2 and Col-1 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-input type="text" name="taskSubject" label="Task subject"
                          value={SALESFORCE_TASK_RECORD.taskSubject} onchange={handleTaskSubject}
                          style="margin: 0; padding: 0">
                        </lightning-input>
                      </div>
                      <!-- <div class="slds-col slds-size--1-of-12 " style="padding: 0px 0px 10px 0px"></div> -->
                      <!-- Row-2 and Col-2 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-input type="date" name="dueDate" label="Due Date"
                          value={SALESFORCE_TASK_RECORD.dueDate} onchange={handledDueDate}>
                        </lightning-input>
                      </div>
                      <!-- Row-3 and Col-1 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-combobox name="priority" label="Priority" value={priorityPicklistValue}
                          data-id="priorityinput" options={priorityList} onchange={handlePriorityChange}
                          required="true">
                        </lightning-combobox>
                      </div>

                      <!-- <div class="slds-col slds-size--1-of-12" style="padding: 0px 0px 10px 0px"></div> -->

                      <!-- Row-3 and Col-2 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-combobox name="status" label="Status" value={statusPicklistValue}
                          options={statusPicklist} onchange={handleStatusChange}>
                        </lightning-combobox>
                      </div>
                      <!-- Row-4 and Col-1 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-input type="date" name="startDate" label="Start Date"
                          value={SALESFORCE_TASK_RECORD.startDate} onchange={handleStartDate}>
                        </lightning-input>
                      </div>
                      <!-- <div class="slds-col slds-size--1-of-12" style="padding: 0px 0px 10px 0px"></div> -->
                      <!-- Row-4 and Col-2 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <lightning-input type="date" name="endDate" label="End Date" onchange={handleEndDate}>
                        </lightning-input>
                      </div>

                      <!-- Related Object Segment-->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <div class="slds-grid">
                          <div style="
                              display: flex;
                              flex-direction: column;
                              width: 100%;
                            ">
                            <div class="slds-form-element__label">
                              Related To
                            </div>
                            <div class="slds-col slds-size--1-of-1" style="width: 100%">
                              <div style="display: flex">
                                <!--New Segment slds-dropdown-trigger-->
                                <div class="slds-form-element__control">
                                  <div class="slds-combobox_container">
                                    <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click"
                                      data-id="iconrelatedobject">
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled"
                                        onclick={handleSelectRelatedObjectValue} onblur={handleRemoveRelatedObject}
                                        aria-haspopup="true" aria-expanded="true" title="Show More">
                                        <!-- <lightning-icon icon-name="utility:down" size="small"></lightning-icon>
                                        <span class="slds-assistive-teemarksxt"></span> -->
                                        <span class="slds-icon_container slds-icon-standard-account slds-current-color"
                                          title="Please Select Related Object">
                                          <svg class="slds-icon slds-icon_small related-object_icon__color"
                                            aria-hidden="true">
                                            <use
                                              xlink:href="/apexpages/slds/latest/assets/icons/standard-sprite/svg/symbols.svg#account">
                                            </use>
                                          </svg>
                                        </span>
                                        <span class="slds-icon_container slds-icon-utility-down slds-current-color"
                                          title="Please Select Related Object">
                                          <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                                            <use
                                              xlink:href="/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#down">
                                            </use>
                                          </svg>
                                          <span class="slds-assistive-text">Please Select Related Object</span>
                                        </span>
                                      </button>


                                      <div class="slds-dropdown slds-dropdown_actions  slds-dropdown_left">
                                        <ul class="slds-dropdown__list" role="menu" aria-label="Show More">
                                          <template for:each={relatedObjectList} for:item="objectName">
                                            <li key={objectName.value} class="slds-dropdown__item slds-is-selected"
                                              role="presentation">
                                              <!-- <a aria-checked="true" href="#" role="menuitemcheckbox" tabindex="0"> -->
                                              <a onclick={handleSelectRelatedObjectName} data-id={objectName.value}>
                                                <span class="slds-truncate" title={objectName.value}>
                                                  <lightning-icon class="slds-m-right_x-small"
                                                    icon-name={objectName.iconName}></lightning-icon>{objectName.value}</span>
                                              </a>
                                            </li>
                                          </template>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
                                </div>


                                <!--New Segment -->
                                <div style="width: 100%">
                                  <c-custom-lookup-component obj-name={relatedOjectName}
                                    search-placeholder={relatedOjectName} default-name={defaultRelatedObjectRecordName}
                                    icon-name={relatedObjectIconName} data-id="relatedCustomLookup"
                                    onlookupselected={handleRelatedLookupSelected}
                                    nolookupselected={handleRelatedNoLookupSelected}></c-custom-lookup-component>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--Related Object Segment-->

                      <!-- Row-5 and Col-1 -->

                      <!-- Segment-2 Starts Here-->

                      <!-- Row-1 and Col-1 -->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <div class="slds-form-element" data-id="taskowner">
                          <label class="slds-form-element__label" for="text-input-id-64">
                            <abbr class="slds-required" title="required">* </abbr>Assign To</label>
                          <div class="slds-form-element__control">
                            <c-custom-lookup-component name="assignTo" label="Assign To" obj-name="User"
                              search-placeholder="Enter Assigned Owner" default-name={defaultAssignRecord}
                              icon-name="standard:user" onlookupselected={handleAssigneeLookup}
                              onnolookupselected={handleNoAssigneeLookup}>
                            </c-custom-lookup-component>
                          </div>
                          <div class="slds-form-element__help" id="error-message-id-65">
                            Please Select Owner
                          </div>
                        </div>
                      </div>

                      <!-- Row-1 and Col-2 -->
                      <!--Phone Number Record Section-->
                      <div class="slds-col slds-size--1-of-2 slds-p-horizontal_medium">
                        <div class="slds-form-element__label">Phone Number</div>
                        <div style="display: flex; flex-direction: column">
                          <c-contact-custom-lookup obj-name="Contact" search-placeholder="Please Enter Phone Number"
                            default-name={defaultContactObjectRecordName} icon-name="utility:call"
                            onlookupselected={handleContactLookupSelected}
                            nolookupselected={handleContactNoLookupSelected}></c-contact-custom-lookup>

                          <div class="slds-grid slds-wrap" style="width: 100%">
                            <div class="slds-col slds-size--7-of-12"></div>
                            <div class="slds-col slds-size--5-of-12">
                              <span style="
                                  font-size: 12px;
                                  color: green;
                                  font-weight: 500;
                                ">
                                <lightning-button-icon icon-name="utility:add" variant="border-filled" title="Add"
                                  class="slds-p-right--xxx-small" size="x-small" onclick={handleCreateNewContact} style="
                                    margin-left: 2px !important;
                                    margin-top: 15px !important;
                                  ">
                                </lightning-button-icon>
                                Add New Phone Number
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--Phone Number Record Section-->
                      <!-- default-name="Cashfree" -->

                      <!-- Segment-2 ends Here-->

                      <!-- Segment-3 starts Here-->
                      <div
                        class="slds-col slds-size--1-of-1 slds-m-top_medium slds-p-bottom_small slds-section-title slds-theme_shade">
                        <p class="slds-m-left--medium slds-m-top--x-small">
                          Other Information
                        </p>
                      </div>
                      <!-- Row-1 and Col-1 -->
                      <div class="slds-col slds-size--6-of-12" style="padding: 0px 0px 10px 0px; padding-right: 18px">
                        <!--  -->
                        <template if:true={IsRemarksVisible}>
                          <article class="slds-card" style="border: 0">
                            <div class="slds-card__header" style="
                                width: 100%;
                                margin: 0;
                                padding: 0;
                                border-bottom: 1px solid grey;
                                padding-bottom: 8px;
                              ">
                              <header>
                                <div class="slds-grid slds-wrap">
                                  <div class="slds-col slds-size--2-of-12 slds-align--absolute-center"
                                    style="margin-left: -8px">
                                    <span style="font-weight: bold">Remarks</span>
                                  </div>
                                  <div class="slds-col slds-size--9-of-12">
                                    <lightning-input type="text" value={remarkObject.Comment}
                                      placeholder="Add remark Here" onchange={handleRemarksCommentChange}>
                                    </lightning-input>
                                  </div>
                                  <div class="slds-col slds-size--1-of-12 slds-m-top--x-small slds-p-top--small">
                                    <lightning-button-icon icon-name="utility:send" variant="border-filled" title="Send"
                                      class="slds-p-right--xxx-small" size="small" onclick={handleRemarksComment} style="
                                        margin-left: 2px !important;
                                        margin-top: 15px !important;
                                      ">
                                    </lightning-button-icon>
                                  </div>
                                </div>
                              </header>
                            </div>

                            <div class="slds-card__body slds-card__body_inner" style="padding: 0">
                              <div if:true={belowTemplate} style="
                                  font-weight: bold;
                                  font-size: 12px;
                                  margin-bottom: 10px;
                                ">
                                Current Remarks
                              </div>
                              <div if:true={belowTemplate} class="slds-scrollable--y" style="height: 173px">
                                <!-- When No Data Available ..... >>>>  -->
                                <div if:false={showRemarks} class="slds-text-longform">
                                  <c-illustration-component display-text="NO REMARKS"></c-illustration-component>
                                </div>
                                <!-- When Data is Available in the List ..... >>>>  -->
                                <div if:true={showRemarks}>
                                  <template for:each={remarksList} for:item="comment">
                                    <div key={comment.remarkIdWrap}>
                                      <div class="slds-grid slds-gutters slds-wrap" style="margin-bottom: 2px">
                                        <!-- name -->

                                        <!-- remarks -->
                                        <!--space-->

                                        <div class="slds-col slds-size--8-of-12">
                                          <div class="slds-media">
                                            <div class="slds-media__body">
                                              <div if:false={comment.taskEdit} style="
                                                  font-size: 12px;
                                                  font-weight: 700;
                                                  word-break: break-all;
                                                ">
                                                {comment.Comment}
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="slds-col slds-size--4-of-12" style="padding-left: 43px">
                                          <div style="color: grey; font-size: 12px">
                                            <p>{comment.createdByName}</p>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </div>
                          </article>
                        </template>
                        <!--  -->
                      </div>
                      <!-- <div class="slds-col slds-size--1-of-12" style="padding: 0px 0px 10px 0px;">
											</div> -->

                      <!--Attachment Section-->
                      <div class="slds-col slds-size--6-of-12" style="padding: 0px 0px 10px 0px; padding-left: 18px">
                        <!--Attachment Part-->
                        <article class="slds-card" style="width: 100%; border: 0ch">
                          <div class="slds-is-relative">
                            <lightning-card varient="Narrow" title="Attachment" style="height: 100px; font-size: small">
                              <div slot="actions" style="width: 100%">
                                <lightning-file-upload name="fileUploader" accept={acceptedFormats} record-id=""
                                  onuploadfinished={handleUploadFinished} multiple>
                                </lightning-file-upload>
                              </div>
                              <div class="slds-scrollable">
                                <div style="
                                    font-weight: bold;
                                    font-size: 15px;
                                    margin-left: 15px;
                                    border-top: 1px solid #c4bcbc !important;
                                  ">
                                  Uploaded
                                </div>
                                <div style="height: 170px" class="slds-var-m-around_medium">
                                  <div if:true={showAttachments}>
                                    <template for:each={attachmentFileArray} for:item="file">
                                      <div key={file.contentVersionId}>
                                        {file.name}
                                      </div>

                                      <template for:each={fileSize} for:item="size">
                                        <div key={size}>{size}</div>
                                      </template>
                                    </template>
                                  </div>
                                </div>
                              </div>
                            </lightning-card>
                          </div>
                        </article>
                        <!--Attachment Part-->
                      </div>
                      <!--Attachment Section-->

                      <!-- Reminder Section-->
                      <div
                        class="slds-col slds-size--1-of-1 slds-m-top_medium slds-p-bottom_small slds-section-title slds-theme_shade">
                        <p class="slds-m-left--medium slds-m-top--x-small">
                          Reminder
                        </p>
                      </div>

                      <div
                        class="slds-col slds-size--5-of-12 slds-p-top_medium slds-p-left_medium slds-p-bottom_x-large">
                        <lightning-input type="checkbox" value={reminderMessage} onchange={handleTaskReminder}
                          label={reminderMessage}></lightning-input>
                      </div>
                      <!-- Reminder Section-->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <!-- Main Body Template Ends Here ... >>> -->

          <!--   Create New Contact  -->
          <template if:true={showContactRecordForm}>
            <div class="slds-p-around_medium">
              <lightning-record-form object-api-name="Contact" oncancel={handleCancelContactRecord} columns="2"
                onsuccess={handleCreateContactRecord} layout-type="Full" record-id={contactId}>
              </lightning-record-form>
            </div>
          </template>
          <!-- Create New Contact -->
        </div>
        <!-- Modal/Popup Box LWC body ends here -->

        <!-- Modal/Popup Box LWC footer starts here -->
        <footer class="slds-modal__footer" data-id="modalfotter">
          <template if:true={showFotterButton}>
            <button class="slds-button slds-button_neutral" onclick={handleCancel} title="Cancel">
              Cancel
            </button>
            <button class="slds-button slds-button_brand" onclick={handleSave} title="Save">
              Save
            </button>
          </template>
        </footer>
        <!-- Modal/Popup Box LWC footer ends here -->
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>
</template>